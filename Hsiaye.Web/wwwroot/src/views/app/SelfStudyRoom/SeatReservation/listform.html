<form class="layui-form" lay-filter="layuiadmin-form-list" id="layuiadmin-form-list" style="padding: 20px 30px 0 0;">

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">预约日期</label>
      <div class="layui-input-inline" style="width: 100px;">
        <input type="text" id="Begin" name="Begin" lay-verify="required" placeholder="开始日期" autocomplete="off"
          class="layui-input">
      </div>
      <div class="layui-form-mid">-</div>
      <div class="layui-input-inline" style="width: 100px;">
        <input type="text" id="End" name="End" lay-verify="required" placeholder="结束日期" autocomplete="off"
          class="layui-input">
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">座位</label>
    <div class="layui-input-inline">
      <script type="text/html" id="tmp_SeatCategoryId" template lay-url="/api/SelfStudyRoom/SeatCategory_Options"
        lay-type="post" lay-done="layui.data.done_SeatCategoryId(d)">
          <select lay-filter="SeatCategoryId" name="SeatCategoryId">
            <option value="0">请选择座位分类</option>
            <!-- 检查是否选择的方法 -->
            {{# var checkSelected = function(item){return item.Id == d.params.SeatCategoryId?'selected':'';};}}
            {{#  layui.each(d.Data, function(index, item){ }}
            <option value="{{ item.Id }}" {{checkSelected(item)}}>{{ item.Name }}</option>
            {{# }); }}
          </select>
        </script>
    </div>
    <div class="layui-input-inline">
      <script type="text/html" id="form_tmp_SeatId" template lay-url="/api/SelfStudyRoom/Seat_Options?seatCategoryId={{d.params.SeatCategoryId}}&begin={{d.params.Begin}}&end={{d.params.End}}" lay-type="post" lay-done="layui.data.done_SeatId(d)">
        <div lay-templateid="form_tmp_SeatId">
       　 <select name="SeatId">
            <option value="0">请选择可选座位</option>
            <!-- 检查是否选择的方法 -->
            {{# var checkSelected = function(item){return item.Id == d.params.SeatId?'selected':'';};}}
            {{#  layui.each(d.Data, function(index, item){ }}
            <option value="{{ item.Id }}" {{checkSelected(item)}} {{item.Description}}>{{ item.Name }} [{{item.Price}}元]</option>
            {{# }); }}
          </select>
        </div>
      </script>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">姓名</label>
    <div class="layui-input-block">
      <input type="text" name="Name" lay-verify="required" placeholder="请输入姓名" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">电话</label>
    <div class="layui-input-block">
      <input type="text" name="Phone" lay-verify="phone" placeholder="请输入电话" autocomplete="off" class="layui-input">
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">学科</label>
    <div class="layui-input-block">
      <script type="text/html" template lay-url="/api/SelfStudyRoom/SeatSubject_Options" lay-type="post"
        lay-done="layui.data.done_SeatSubjectId(d);">
        <select name="SeatSubjectId" lay-verify="required">
          <option value="">请选择</option>
          <!-- 检查是否选择的方法 -->
          {{# var checkSelected = function(item){return item.Id == d.params.SeatSubjectId?'selected':'';};}}
          {{#  layui.each(d.Data, function(index, item){ }}
          <option value="{{ item.Id }}" {{checkSelected(item)}}>{{ item.Name }}</option>
          {{#  }); }}
        </select>
      </script>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">说明</label>
    <div class="layui-input-block">
      <textarea name="Description" autocomplete="off" class="layui-textarea">无</textarea>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">操作者备注</label>
    <div class="layui-input-block">
      <textarea name="OperatorRemark" autocomplete="off" class="layui-textarea">无</textarea>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">状态</label>
    <div class="layui-input-block">
      <input type="checkbox" name="Normal" lay-skin="switch" lay-text="正常|停用" value="true" checked>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">签到</label>
    <div class="layui-input-block">
      <input type="checkbox" name="Reported" lay-skin="switch" lay-text="已签|待签" value="true" checked>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-block">
      <input type="button" lay-submit lay-filter="layuiadmin-app-SeatReservation-submit" value="确认" class="layui-btn">
    </div>
  </div>
</form>

<script>

  var today = new Date();
  var begin = end = today.toLocaleDateString().replace(/\//g, "-");


  layui.data.done_SeatCategoryId = function (d) {
    layui.use(['form'], function () {
      var $ = layui.$
        , form = layui.form;
      form.render('select')
      // form.val('layuiadmin-form-list', d.params)
      // layui.data.renderSeatOptions();//刷新座位下拉选框
    })
  };

  layui.data.done_SeatId = function (d) {
    layui.use(['form'], function () {
      var $ = layui.$
        , form = layui.form;
      // console.log($('#form_tmp_SeatId').attr("lay-url"))
      // console.log(d);
      form.render('select')
      // form.val('layuiadmin-form-list', d.params)
      // form.val('layuiadmin-form-list', { 'SeatId': 15 })
    })
  };

  layui.data.done_SeatSubjectId = function (d) {
    layui.use(['form'], function () {
      var $ = layui.$
        , form = layui.form;
      form.render('select')
      // form.val('layuiadmin-form-list', d.params)
    })
  };

  layui.use(['admin', 'form', 'laydate'], function () {
    var $ = layui.$
      , admin = layui.admin
      , view = layui.view
      , form = layui.form
      , laydate = layui.laydate;
    // 开始时间
    laydate.render({
      elem: '#Begin', value: begin, done: function (value, date, endDate) {
        laydate.render({ elem: '#End', value: value });
        begin = end = value;
        layui.data.renderSeatOptions();//刷新座位下拉选框
      }
    });

    // 结束时间
    laydate.render({
      elem: '#End', value: end, done: function (value, date, endDate) {
        end = value;
        layui.data.renderSeatOptions();//刷新座位下拉选框
      }
    });

    // 监听座位类型选择
    form.on('select(SeatCategoryId)', function (data) {
      layui.data.renderSeatOptions();//刷新座位下拉选框
    });
  })

  layui.data.renderSeatOptions = function () {
    layui.use(['admin', 'form', 'laydate'], function () {
      var $ = layui.$
        , admin = layui.admin
        , view = layui.view
        , form = layui.form
        , laydate = layui.laydate;

      // 渲染座位下拉选框
      var seatCategoryId = form.val("layuiadmin-form-list")['SeatCategoryId'];
      begin = form.val("layuiadmin-form-list")['Begin'];
      end = form.val("layuiadmin-form-list")['End'];
      if (seatCategoryId == false) {
        return layer.msg("请选择座位分类");
      }
      if (begin == false) {
        return layer.msg("请选择开始日期");
      }
      if (begin == false) {
        return layer.msg("请选择结束日期");
      }
      // 渲染座位单选表单元素
      $('#form_tmp_SeatId').attr("lay-url", "/api/SelfStudyRoom/Seat_Options?seatCategoryId=" + seatCategoryId + "&begin=" + begin + "&end=" + end);
      view('form_tmp_SeatId').refresh();
    });
  };

</script>