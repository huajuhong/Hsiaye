<fieldset class="layui-elem-field layui-field-title">
  <legend>自习室座位预约</legend>
  <div class="layui-field-box">
    <form class="layui-form" lay-filter="layuiadmin-form-list" id="layuiadmin-form-list"
      style="padding: 20px 30px 0 0;">

      <!-- <input type="hidden" name="OrganizationUnitId" value="1"> -->

      <div class="layui-form-item">
        <label class="layui-form-label">座位</label>
        <div class="layui-input-block">
          <script type="text/html" template lay-url="/api/SelfStudyRoom/Seat_Options" lay-type="post"
            lay-done="layui.data.done(d);">
            <select name="SeatId" lay-verify="required" lay-search>
              <option value="">请选择</option>
              {{#  layui.each(d.Data, function(index, item){ }}
              <option value="{{ item.Id }}">{{ item.Name }} [{{item.SeatCategory.Name}}] [{{ item.SeatCategory.BeginTime }} - {{ item.SeatCategory.EndTime }}] [{{item.SeatCategory.Price}}元]</option>
              {{#  }); }}
            </select>
          </script>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">名称</label>
        <div class="layui-input-block">
          <input type="text" name="Name" lay-verify="required" placeholder="请输入名称" autocomplete="off"
            class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">电话</label>
        <div class="layui-input-block">
          <input type="text" id="Phone" name="Phone" lay-verify="phone" placeholder="请输入电话" autocomplete="off"
            class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">开始日期</label>
        <div class="layui-input-block">
          <input type="text" id="Begin" name="Begin" lay-verify="required" placeholder="请选择预约开始日期" autocomplete="off"
            class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">结束日期</label>
        <div class="layui-input-block">
          <input type="text" id="End" name="End" lay-verify="required" placeholder="请选择预约结束日期" autocomplete="off"
            class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">学科</label>
        <div class="layui-input-block">
          <script type="text/html" template lay-url="/api/SelfStudyRoom/SeatSubject_Options" lay-type="post"
            lay-done="layui.data.done(d);">
            <select name="SeatSubjectId" lay-verify="required">
              <option value="">请选择</option>
              {{#  layui.each(d.Data, function(index, item){ }}
              <option value="{{ item.Id }}">{{ item.Name }}</option>
              {{#  }); }}
            </select>
          </script>
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label">图形验证码</label>
          <div class="layui-input-inline">
            <input type="text" name="imageCode" id="ImageCode" lay-verify="required" placeholder="图形验证码"
              class="layui-input">
          </div>
          <div class="layui-input-inline">
            <img class="layadmin-user-login-codeimg" id="LAY-get-imageCode">
          </div>
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label">短信验证码</label>
          <div class="layui-input-inline">
            <input type="text" name="smsCode" id="smsCode" lay-verify="required" placeholder="短信验证码"
              class="layui-input">
          </div>
          <div class="layui-input-inline">
            <button type="button" class="layui-btn layui-btn-primary layui-btn-fluid"
              id="LAY-get-smscode">获取验证码</button>
          </div>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label"></label>
        <div class="layui-input-block">
          <input type="button" lay-submit lay-filter="layuiadmin-app-SeatReservation-submit" value="确认"
            class="layui-btn">
        </div>
      </div>
    </form>
  </div>
</fieldset>


<script>

  layui.data.done = function (d) {
    layui.use(['admin', 'form', 'laydate'], function () {
      var $ = layui.$
        , admin = layui.admin
        , view = layui.view
        , table = layui.table
        , form = layui.form
        , laydate = layui.laydate;

      laydate.render({ elem: '#Begin' });
      laydate.render({ elem: '#End' });

      form.val("layuiadmin-form-list", { "SeatSubjectId": d.params.SeatSubjectId });
      form.val("layuiadmin-form-list", { "SeatId": d.params.SeatId });

      form.render('select'); //刷新select选择框渲染
    })
  };

  layui.use(['admin', 'laydate', 'user'], function () {
    var $ = layui.$
      , admin = layui.admin
      , view = layui.view
      , form = layui.form
      , laydate = layui.laydate;

    // 获取图形验证码
    $('#LAY-get-imageCode').trigger('click');

    //发送短信验证码
    admin.sendAuthCode({ elem: '#LAY-get-smscode' });

    // 提交
    form.on('submit(layuiadmin-app-SeatReservation-submit)', function (data) {
      //提交 Ajax 成功后，关闭当前弹层并重载表格
      admin.req({
        url: '/api/SelfStudyRoom/SeatReservation?smsCode=' + $('#smsCode').val()
        , type: 'post'
        , contentType: 'application/json'
        , data: data.field
        , done: function (res) {
          layer.alert("预约成功！")
        }
      });
    });
  });
</script>